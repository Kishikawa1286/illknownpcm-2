# This file is auto-generated from twofold_interval.jmd.
# Do not edit this file manually.

module TwofoldIntervalArithmetic

import Base: âˆˆ, âˆ‹, âŠ†, âŠ‡
using IntervalArithmetic
using IntervalArithmetic.Symbols

include("../../nearly_equal/v1/nearly_equal.jl")
using .NearlyEqual

const TwofoldInterval = Tuple{Interval{T},Interval{T}} where {T<:Real}

"""
    isTwofoldInterval(
        ğ’œ;
        allow_uncommon_inner_interval=true,
        strict=false
    )

Check whether `ğ’œ` is a twofold interval.
"""
@inline function isTwofoldInterval(
    ğ’œ::TwofoldInterval;
    allow_uncommon_inner_interval::Bool=true,
    strict::Bool=false
)::Bool
    ğ’œâ» = inner(ğ’œ)
    ğ’œâº = outer(ğ’œ)

    # Check if outer interval is common
    if !iscommon(ğ’œâº)
        return false
    end

    # Check if inner interval is common
    if !iscommon(ğ’œâ»)
        if allow_uncommon_inner_interval
            return true
        else
            return false
        end
    end

    Î±á´¸â» = inf(ğ’œâ»)
    Î±áµâ» = sup(ğ’œâ»)
    Î±á´¸âº = inf(ğ’œâº)
    Î±áµâº = sup(ğ’œâº)

    # aá´¸â» â‰ˆ aá´¸âº is allowed (but should be corrected)
    if Î±á´¸â» < Î±á´¸âº && (strict || !isNearlyEqual(Î±á´¸â», Î±á´¸âº))
        return false
    end
    # aáµâ» â‰ˆ aáµâº is allowed (but should be corrected)
    if Î±áµâ» > Î±áµâº && (strict || !isNearlyEqual(Î±áµâ», Î±áµâº))
        return false
    end

    return true
end

export TwofoldInterval, isTwofoldInterval

"""
    isincluded(A, ğ’œ; strict=false)

Check whether `A` is included in `ğ’œ`.
Throw an `ArgumentError` if `ğ’œ` is not a twofold interval.
"""
@inline function isincluded(
    A::Interval{T},
    ğ’œ::TwofoldInterval{T};
    strict::Bool=false
)::Bool where {T<:Real}
    if !isTwofoldInterval(ğ’œ; strict=strict)
        throw(ArgumentError("ğ’œ is not a twofold interval"))
    end

    tolerance = strict ? 1e-10 : 1e-6

    ğ’œâ» = inner(ğ’œ)
    ğ’œâº = outer(ğ’œ)
    aá´¸ = inf(A)
    aáµ = sup(A)
    Î±á´¸â» = inf(ğ’œâ»)
    Î±áµâ» = sup(ğ’œâ»)
    Î±á´¸âº = inf(ğ’œâº)
    Î±áµâº = sup(ğ’œâº)

    if Î±á´¸âº â‰¤ aá´¸ â‰¤ Î±á´¸â» &&
       Î±áµâ» â‰¤ aáµ â‰¤ Î±áµâº
        return true
    end

    if (isNearlyEqual(aá´¸, Î±á´¸âº; tolerance=tolerance) ||
        isNearlyEqual(aá´¸, Î±á´¸â»; tolerance=tolerance)) &&
       (isNearlyEqual(aáµ, Î±áµâº; tolerance=tolerance) ||
        isNearlyEqual(aáµ, Î±áµâ»; tolerance=tolerance))
        return true
    end

    return false
end

"""
    âˆˆ(A, ğ’œ)

Unicode alias for `isincluded(A, ğ’œ)`.
"""
âˆˆ(A::Interval, ğ’œ::TwofoldInterval)::Bool = isincluded(A, ğ’œ)

"""
    âˆ‹(ğ’œ, A)

Unicode alias for `isincluded(A, ğ’œ)`.
"""
âˆ‹(ğ’œ::TwofoldInterval, A::Interval)::Bool = isincluded(A, ğ’œ)

export isincluded, âˆˆ, âˆ‹

"""
    isincluded(ğ’œ, â„¬; strict=false)

Check whether `ğ’œ` is included in `â„¬`.
Throw an `ArgumentError` if `ğ’œ` and `â„¬` is not a twofold interval.
"""
@inline function isincluded(
    ğ’œ::TwofoldInterval{T},
    â„¬::TwofoldInterval{T};
    strict::Bool=false
)::Bool where {T<:Real}
    if !isTwofoldInterval(ğ’œ; strict=strict)
        throw(ArgumentError("ğ’œ is not a twofold interval"))
    end
    if !isTwofoldInterval(â„¬; strict=strict)
        throw(ArgumentError("â„¬ is not a twofold interval"))
    end

    tolerance = strict ? 1e-10 : 1e-6

    ğ’œâ» = inner(ğ’œ)
    ğ’œâº = outer(ğ’œ)
    Î±á´¸â» = inf(ğ’œâ»)
    Î±áµâ» = sup(ğ’œâ»)
    Î±á´¸âº = inf(ğ’œâº)
    Î±áµâº = sup(ğ’œâº)
    â„¬â» = inner(â„¬)
    â„¬âº = outer(â„¬)
    Î²á´¸â» = inf(â„¬â»)
    Î²áµâ» = sup(â„¬â»)
    Î²á´¸âº = inf(â„¬âº)
    Î²áµâº = sup(â„¬âº)

    if (Î²á´¸âº â‰¤ Î±á´¸âº || isNearlyEqual(Î²á´¸âº, Î±á´¸âº; tolerance=tolerance)) &&
       (Î±á´¸â» â‰¤ Î²á´¸â» || isNearlyEqual(Î±á´¸â», Î²á´¸â»; tolerance=tolerance)) &&
       (Î²áµâ» â‰¤ Î±áµâ» || isNearlyEqual(Î²áµâ», Î±áµâ»; tolerance=tolerance)) &&
       (Î±áµâº â‰¤ Î²áµâº || isNearlyEqual(Î±áµâº, Î²áµâº; tolerance=tolerance))
        return true
    end

    return false
end

"""
    âŠ†(ğ’œ, â„¬)

Unicode alias for `isincluded(ğ’œ, â„¬)`.
"""
âŠ†(ğ’œ::TwofoldInterval, â„¬::TwofoldInterval)::Bool = isincluded(ğ’œ, â„¬)

"""
    âŠ‡(â„¬, ğ’œ)

Unicode alias for `isincluded(ğ’œ, â„¬)`.
"""
âŠ‡(â„¬::TwofoldInterval, ğ’œ::TwofoldInterval)::Bool = isincluded(ğ’œ, â„¬)

export isincluded, âŠ†, âŠ‡

"""
    inner(A)

Get inner interval of twofold interval `A`.
"""
inner(A::TwofoldInterval)::Interval = A[1]

"""
    inner(ğ’²)

Get the inner intervals of twofold interval vector `ğ’²`.
"""
function inner(ğ’²::Vector{TwofoldInterval})::Vector{Interval}
    return [inner(ğ’²áµ¢) for ğ’²áµ¢ in ğ’²]
end

"""
    inner(ğ’œ)

Extract the interval matrix consisting of the inner intervals of the each element of the twofold interval matrix `ğ’œ`.
"""
function inner(
    ğ’œ::Matrix{TwofoldInterval{T}}
)::Matrix{Interval{T}} where {T<:Real}
    m, n = size(ğ’œ)
    ğ’œâ» = Matrix{Interval}(undef, m, n)

    for i = 1:m, j = 1:n
        ğ’œâ»[i, j] = ğ’œ[i, j][1]
    end

    return ğ’œâ»
end

"""
    outer(A)

Get outer interval of twofold interval `A`.
"""
outer(A::TwofoldInterval)::Interval = A[2]

"""
    outer(ğ’²)

Get the outer intervals of twofold interval vector `ğ’²`.
"""
function outer(ğ’²::Vector{TwofoldInterval})::Vector{Interval}
    return [outer(ğ’²áµ¢) for ğ’²áµ¢ in ğ’²]
end

"""
    outer(ğ’œ)

Extract the interval matrix consisting of the outer intervals of the each element of the twofold interval matrix `ğ’œ`.
"""
function outer(
    ğ’œ::Matrix{TwofoldInterval{T}}
)::Matrix{Interval{T}} where {T<:Real}
    m, n = size(ğ’œ)
    ğ’œâº = Matrix{Interval}(undef, m, n)

    for i = 1:m, j = 1:n
        ğ’œâº[i, j] = ğ’œ[i, j][2]
    end

    return ğ’œâº
end

export inner, outer

end
